{% extends 'base.html' %}

{% block title %}Orders by Period - Gulmohur{% endblock %}
{% block page_title %}Orders by Period{% endblock %}
{% block page_subtitle %}Filter orders by delivery date range{% endblock %}

{% block content %}
<div class="space-y-6">

  <!-- Date Filter Form -->
  <div class="glass-effect rounded-2xl p-6 shadow-lg">
    <form method="GET" action="{{ url_for('orders_by_period') }}" class="flex flex-col md:flex-row gap-4">
      <div class="flex-1">
        <label class="block text-sm font-semibold text-gray-700 mb-2">From Date</label>
        <input type="date" name="from_date" value="{{ from_date or '' }}" required
               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
      </div>
      <div class="flex-1">
        <label class="block text-sm font-semibold text-gray-700 mb-2">To Date</label>
        <input type="date" name="to_date" value="{{ to_date or '' }}" required
               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
      </div>
      <div class="flex items-end">
        <button type="submit" class="px-6 py-3 bg-primary-600 text-white rounded-xl font-semibold">
          Search Orders
        </button>
      </div>
    </form>
  </div>

  {% if orders is none %}
  <!-- Initial state: no search has been performed -->
  <div class="glass-effect rounded-2xl p-12 text-center">
    <h3 class="text-xl font-semibold text-gray-900 mb-2">Select Date Range</h3>
    <p class="text-gray-600">Choose start and end dates above to view orders.</p>
  </div>

  {% elif orders|length == 0 %}
  <!-- No results -->
  <div class="glass-effect rounded-2xl p-12 text-center">
    <h3 class="text-xl font-semibold text-gray-900 mb-2">No orders found</h3>
    <p class="text-gray-600">No orders found between {{ from_date }} and {{ to_date }}.</p>
  </div>

  {% else %}

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
    <div class="glass-effect rounded-xl p-6 border-l-4 border-blue-500">
      <p class="text-sm font-semibold text-gray-500 mb-1">Total Orders</p>
      <p class="text-3xl font-bold text-gray-900">{{ orders|length }}</p>
    </div>
    <div class="glass-effect rounded-xl p-6 border-l-4 border-green-500">
      <p class="text-sm font-semibold text-gray-500 mb-1">Delivered</p>
      <p class="text-3xl font-bold text-green-700">{{ orders|selectattr('status','equalto','Delivered')|list|length }}</p>
    </div>
    <div class="glass-effect rounded-xl p-6 border-l-4 border-yellow-500">
      <p class="text-sm font-semibold text-gray-500 mb-1">Pending</p>
      <p class="text-3xl font-bold text-yellow-700">{{ orders|selectattr('status','equalto','Pending')|list|length }}</p>
    </div>
    <div class="glass-effect rounded-xl p-6 border-l-4 border-red-500">
      <p class="text-sm font-semibold text-gray-500 mb-1">Total Outstanding</p>
      <p class="text-3xl font-bold text-red-700">₹{{ orders|sum(attribute='balance_amount') }}</p>
    </div>
  </div>

  <!-- Orders Table -->
  <div class="overflow-x-auto rounded-xl border border-gray-200">
    <table class="min-w-full bg-white">
      <thead>
        <tr class="bg-primary-600 text-white">
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Order #</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Customer</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Dress Type</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Delivery Date</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Total Amount</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Pending</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Status</th>
          <th class="px-4 py-3 text-center text-xs font-semibold uppercase">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        {% for order in orders %}
        <tr>
          <td class="px-4 py-3 text-sm font-semibold text-gray-900">{{ order.order_number or order.id }}</td>
          <td class="px-4 py-3 text-sm text-gray-700">{{ order.customer_name }}</td>
          <td class="px-4 py-3 text-sm text-gray-700">{{ order.dress_type }}</td>
          <td class="px-4 py-3 text-sm text-gray-700">{{ order.delivery_date }}</td>
          <td class="px-4 py-3 text-sm font-semibold text-gray-900">₹{{ order.price }}</td>
          <td class="px-4 py-3 text-sm font-semibold text-red-700">₹{{ order.balance_amount }}</td>
          <td class="px-4 py-3 text-sm">{{ order.status }}</td>
          <td class="px-4 py-3 text-center">
            <a href="{{ url_for('edit_order', order_id=order.id) }}" class="text-primary-600">Edit</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% endif %}

</div>
{% endblock %}
